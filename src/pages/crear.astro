---
import Layout from "../layouts/Layout.astro"
---

<Layout title="Crear Sorteo - Amigo Invisible">
  <div class="container">
    <div style="text-align: center; margin-bottom: 3rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸŽ¯ Crear Nuevo Sorteo</h1>
      <p style="font-size: 1.1rem; color: rgba(255,255,255,0.8); max-width: 500px; margin: 0 auto;">
        Configura tu sorteo de amigo invisible en pocos pasos
      </p>
    </div>

    <form id="create-game-form" style="max-width: 700px; margin: 0 auto;">
      <div style="margin-bottom: 2rem;">
        <label for="gameName">ðŸŽ® Nombre del Sorteo:</label>
        <input
          type="text"
          id="gameName"
          name="gameName"
          placeholder="Ej: Amigo Invisible de la Oficina 2025"
          required
        />
      </div>

      <div style="margin-bottom: 2rem;">
        <label for="budget">ðŸ’° Presupuesto (opcional):</label>
        <input
          type="number"
          id="budget"
          name="budget"
          placeholder="Ej: 25"
          min="0"
        />
        <small style="color: rgba(255,255,255,0.7); font-size: 0.9rem; display: block; margin-top: 8px;">
          ðŸ’¡ Deja vacÃ­o si no hay lÃ­mite de presupuesto
        </small>
      </div>

      <div style="margin-bottom: 2rem;">
        <label>ðŸ‘¥ Participantes:</label>
        <div id="participants-list" style="margin-top: 1rem;"></div>
        <button type="button" id="add-participant" class="btn-secondary" style="margin-top: 1rem;">
          âž• AÃ±adir Participante
        </button>
      </div>

      <div style="margin-bottom: 2rem;">
        <label>ðŸš« Excepciones:</label>
        <small style="color: rgba(255,255,255,0.7); font-size: 0.9rem; display: block; margin-bottom: 1rem;">
          Configura quiÃ©n NO puede regalar a quiÃ©n (opcional)
        </small>
        <div id="exceptions-list" style="margin-top: 1rem;"></div>
        <button type="button" id="add-exception" class="btn-secondary" style="margin-top: 1rem; background: linear-gradient(45deg, #ed8936, #dd6b20);">
          ðŸš« AÃ±adir ExcepciÃ³n
        </button>
      </div>

      <button type="submit" style="margin-top: 2rem; font-size: 1.1rem;">
        ðŸš€ Crear Sorteo y Enviar Correos
      </button>
    </form>

    <!-- Modal de Ã©xito -->
    <div id="success-modal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 hidden">
      <div class="modal-content bg-white rounded-lg shadow-lg p-8 max-w-md text-center">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸŽ‰</div>
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; color: #22c55e;">Â¡Sorteo Creado!</h2>
        <p style="margin-bottom: 2rem; color: #6b7280; line-height: 1.6;">Los correos han sido enviados a todos los participantes con sus asignaciones secretas.</p>
        <button id="close-modal" class="btn-primary" style="width: auto; display: inline-block;">
          âœ¨ Â¡Perfecto!
        </button>
      </div>
    </div>

    <!-- Spinner de carga -->
    <div id="loading-spinner" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
      <div class="modal-content text-center" style="background: rgba(255,255,255,0.95); padding: 3rem;">
        <div style="margin-bottom: 2rem;">
          <div style="width: 60px; height: 60px; border: 4px solid #e2e8f0; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        </div>
        <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; color: #4a5568;">Creando tu sorteo...</h3>
        <p style="color: #6b7280;">Enviando correos a todos los participantes</p>
      </div>
    </div>
  </div>
</Layout>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<script type="module" src="/scripts/formHandler.js" defer></script>
